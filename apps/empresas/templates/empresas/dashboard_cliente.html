{% extends "base.html" %}
{% load static %}

{% block title %}Buscar Canchas{% endblock %}

{% block content %}
<div class="content-container">
    <div class="header-section">
        <h1 class="page-title">Encuentra tu Cancha</h1>
        <p class="text-muted">Explora y reserva la cancha perfecta.</p>
    </div>

    <div class="client-dashboard-grid">
        {% for cancha in canchas %}
        <div class="cancha-card-client">
            <div class="cancha-image">
                {% if cancha.foto_principal %}
                    <img src="{{ cancha.foto_principal.imagen.url }}" alt="{{ cancha.nombre }}">
                {% else %}
                    <div class="no-photo"></div>
                {% endif %}
                <span class="price-tag">${{ cancha.precio_hora|floatformat:0 }}/hr</span>
            </div>
            <div class="cancha-content">
                <h3>{{ cancha.nombre }}</h3>
                <small class="text-muted">{{ cancha.empresa.nombre }}</small>
            </div>
            <div class="disponibilidad-section">
                <h4>Horarios Disponibles</h4>
                <div class="disponibilidad-list-client">
                    {% for d in cancha.disponibilidades.all %}
                        {% if d.estado == 'LIBRE' %}
                        <div class="disponibilidad-item-client">
                            <span>{{ d.fecha|date:"D, d M" }} - {{ d.hora_inicio|time:"H:i" }}</span>
                            <!-- Pasamos la URL de la API en data-url -->
                            <button class="btn-reservar"
                                    data-url="{% url 'api_reservar' %}"
                                    onclick="reservarHorario('{{ d.id }}', this)">
                                Reservar
                            </button>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="alert-box">
            <p>No hay canchas disponibles.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% static 'js/client_dashboard.js' %}"></script>
{% endblock %}